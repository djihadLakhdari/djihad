
<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>๐ ุณูุฉ ุงูุชุณูู</title>
      <link rel="stylesheet" href="style.css">

</head>
<body>

<h2>๐ ุณูุฉ ุงูุชุณูู ุงูุฎุงุตุฉ ุจู</h2>

<?php if (isset($_GET['updated'])): ?>
    <div class="message">โ ุชู ุชุญุฏูุซ ุงููููุฉ ุจูุฌุงุญ.</div>
<?php elseif (isset($_GET['removed'])): ?>
    <div class="message" style="color:red;">๐๏ธ ุชู ุญุฐู ุงูููุชุฌ ูู ุงูุณูุฉ.</div>
<?php endif; ?>

<?php if (empty($items)): ?>
    <p class="empty">๐ซ ูุง ุชูุฌุฏ ููุชุฌุงุช ูู ุงูุณูุฉ.</p>
<?php else: ?>
<table>
    <tr>
        <th>ุงูุตูุฑุฉ</th>
        <th>ุงูุงุณู</th>
        <th>ุงูุณุนุฑ</th>
        <th>ุงููููุฉ</th>
        <th>ุงููุฌููุน</th>
        <th>ุญุฐู</th>
    </tr>
    <?php foreach ($items as $item): 
        $subtotal = $item['price'] * $item['quantity'];
        $total += $subtotal;
    ?>
    <tr>
        <td><img src="<?= htmlspecialchars($item['image']) ?>"></td>
        <td><?= htmlspecialchars($item['name']) ?></td>
        <td><?= $item['price'] ?> ุฏุฌ</td>
        <td>
            <form method="post" style="display: inline-flex; align-items: center;">
                <input type="number" name="quantity" value="<?= $item['quantity'] ?>" min="1">
                <input type="hidden" name="product_id" value="<?= $item['id'] ?>">
                <button type="submit" name="update" class="update">๐</button>
            </form>
        </td>
        <td><?= $subtotal ?> ุฏุฌ</td>
<td>
    <button class="remove" onclick="removeFromCart(<?= $item['id'] ?>)">๐</button>
</td>
    </tr>
    <?php endforeach; ?>
</table>

<div class="total">ุงููุฌููุน ุงูููู: <?= $total ?> ุฏุฌ</div>
<button class="checkout" onclick="window.location.href='checkout.php'">โ ุฅููุงู ุงูุดุฑุงุก</button>

<?php endif; ?>
<script>
function removeFromCart(productId) {
    if (confirm("โ ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูููุชุฌุ")) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "delete_cart_item.php", true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

        xhr.onload = function() {
            if (xhr.status == 200 && xhr.responseText.trim() == "deleted") {
             
                location.reload();
            } else {
                alert("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญุฐู ุงูููุชุฌ.");
            }
        }

        xhr.send("product_id=" + productId);
    }
}
</script>

</body>
</html>